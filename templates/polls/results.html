{% extends "base.html" %}

{% block title %}–†–µ–∑—É–ª—å—Ç–∞—Ç—ã | {{ poll.title }} | –ß—Ç–æ –Ω–∞ –æ–±–µ–¥?{% endblock %}

{% block content %}
<div class="card">
    <h2 class="card-title">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–ø—Ä–æ—Å–∞ "{{ poll.title }}"</h2>
    
    <div class="card-meta">
        {% if poll.creator_id %}
            <p>–°–æ–∑–¥–∞—Ç–µ–ª—å: {{ poll.creator.username }}</p>
        {% elif poll.creator_name %}
            <p>–°–æ–∑–¥–∞—Ç–µ–ª—å: {{ poll.creator_name }}</p>
        {% endif %}
        
        <p>–°–æ–∑–¥–∞–Ω: {{ poll.created_at.strftime('%d.%m.%Y %H:%M') }}</p>
        
        {% if poll.deadline %}
            <p>–î–µ–¥–ª–∞–π–Ω: {{ poll.deadline.strftime('%d.%m.%Y %H:%M') }}</p>
        {% endif %}
        
        <p>–°—Ç–∞—Ç—É—Å: 
            {% if poll.active and not poll.is_expired() %}
                <span class="badge badge-success">–ì–æ–ª–æ—Å–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è</span>
            {% else %}
                <span class="badge badge-warning">–û–ø—Ä–æ—Å –∑–∞–≤–µ—Ä—à–µ–Ω</span>
            {% endif %}
        </p>
    </div>
    
    {% if poll.description %}
        <p class="poll-description">{{ poll.description }}</p>
    {% endif %}
    
    <div class="share-poll">
        <button id="copy-poll-link" class="btn btn-secondary" data-link="{{ url_for('polls.results', poll_hash=poll.url_hash, _external=True) }}">
            –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏
        </button>
    </div>
    
    <hr>
    
    <h3>–ò—Ç–æ–≥–∏ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è:</h3>
    
    {% if results %}
        <div class="results-list">
            {% for result in results %}
                <div class="result-item {% if loop.first %}winner{% endif %}">
                    <h4>{{ result.option.name }} {% if loop.first %}üèÜ{% endif %}</h4>
                    
                    {% if result.option.description %}
                        <p>{{ result.option.description }}</p>
                    {% endif %}
                    
                    <div class="result-score">
                        <span class="likes">üëç {{ result.likes }}</span>
                        <span class="neutrals">üòê {{ result.neutrals }}</span>
                        <span class="dislikes">üëé {{ result.dislikes }}</span>
                        <span class="total-score">–ò—Ç–æ–≥–æ–≤—ã–π —Ä–µ–π—Ç–∏–Ω–≥: <strong>{{ result.score }}</strong></span>
                    </div>
                </div>
            {% endfor %}
        </div>
        
        {% if poll.active and not poll.is_expired() %}
            <div class="poll-actions">
                <a href="{{ url_for('polls.view', poll_hash=poll.url_hash) }}" class="btn">–ü—Ä–∏–Ω—è—Ç—å —É—á–∞—Å—Ç–∏–µ –≤ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–∏</a>
            </div>
        {% endif %}
    {% else %}
        <p>–ù–∏–∫—Ç–æ –µ—â–µ –Ω–µ –ø—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞–ª –≤ —ç—Ç–æ–º –æ–ø—Ä–æ—Å–µ.</p>
        
        {% if poll.active and not poll.is_expired() %}
            <div class="poll-actions">
                <a href="{{ url_for('polls.view', poll_hash=poll.url_hash) }}" class="btn">–ü—Ä–∏–Ω—è—Ç—å —É—á–∞—Å—Ç–∏–µ –≤ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–∏</a>
            </div>
        {% endif %}
    {% endif %}
    
    {% if poll.active and (current_user.is_authenticated and poll.creator_id == current_user.id) or (not current_user.is_authenticated and 'created_polls' in session and poll.id in session['created_polls']) %}
        <hr>
        <div class="admin-actions">
            <h4>–î–µ–π—Å—Ç–≤–∏—è —Å–æ–∑–¥–∞—Ç–µ–ª—è:</h4>
            <button class="btn btn-warning btn-finish-poll" data-url="{{ url_for('polls.finish_poll', poll_hash=poll.url_hash) }}">–ó–∞–≤–µ—Ä—à–∏—Ç—å –æ–ø—Ä–æ—Å</button>
        </div>
    {% endif %}
</div>
{% endblock %}